<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>商品详情页</title>
	<link href="static/assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" s>
	<link href="static/assets/global/css/components.css" rel="stylesheet" type="text/css">
	<link href="static/assets/admin/pages/css/login.css" rel="stylesheet" type="text/css">
	<script src="static/assets/global/plugins/jquery-1.11.0.min.js" type="text/javascript"></script>
</head>
<body class="login">
<div class="content">
	<h3 class="form-title">商品详情</h3>
	<div class="form-group">
		<label class="control-label">商品名</label>
		<div>
			<label class="control-label" id="title"></label>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">商品描述</label>
		<div>
			<label class="control-label" id="description"></label>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">价格</label>
		<div>
			<label class="control-label" id="price"></label>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">图片</label>
		<div>
			<img style="width: 200px;height: auto;" id="imgUrl">
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">库存</label>
		<div>
			<label class="control-label" id="stock"></label>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label">销量</label>
		<div>
			<label class="control-label" id="sales"></label>
		</div>
	</div>
	<div class="form-actions">
		<button class="btn blue" id="create_order" type="submit">下单</button>
	</div>
</div>
</body>
<script>
  $(document).ready(function(){
    function GetQueryString(name)
    {
      var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if(r!=null)return  unescape(r[2]); return null;
    }
    var id = GetQueryString('id');
    $.ajax({
      type: 'GET',
      // contentType:'application/x-www-form-urlencoded',
      url:'http://localhost:8090/item/getItem' ,
      data: {id:id},
      xhrFields: {withCredentials:true},	//前端适配：允许session跨域
      crossDomain: true,
      beforeSend: function (xhr) {
      },
      complete: function (obj) {

      },
      success: function (obj) {
        if (obj.status == 'success') {
          $('#title').html(obj.data.title);
          $('#description').html(obj.data.description);
          $('#price').html(obj.data.price);
          $('#imgUrl').attr("src",obj.data.imgUrl);
          $('#stock').html(obj.data.stock);
          $('#sales').html(obj.data.sales);
        }else {
          alert("获取数据失败："+ obj.data.errMsg)
        }
      },
      error: function (xhr) {
        alert("获取数据失败");
        console.log(xhr);
      },
    });
    $(document).on('click','#create_order',function (){//下单
      // var itemId = $('#itemId')
      $.ajax({
        type: 'POST',
        // contentType:'application/x-www-form-urlencoded',
        url:'http://localhost:8090/order/createOrder' ,
        data: {itemId:id,amount:1},
        xhrFields: {withCredentials:true},	//前端适配：允许session跨域
        crossDomain: true,
        beforeSend: function (xhr) {
        },
        complete: function (obj) {

        },
        success: function (obj) {
          if (obj.status == 'success') {
            alert("下单成功")
			window.location.reload();
          }else {
            alert("下单失败："+ obj.data.errMsg)
			if (obj.data.errCode == 200003){
			  window.location.href="login.index.html";
			}
          }
        },
        error: function (xhr) {
          alert("下单失败");
          console.log(xhr);
        },
      });
	});
  });

</script>
</html>